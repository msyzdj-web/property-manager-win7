# 问题解决指南

## 问题1：Qt平台插件错误

### 错误信息
```
qt.qpa.plugin: Could not find the Qt platform plugin "windows" in ""
This application failed to start because no Qt platform plugin could be initialized.
```

### 原因
PyQt5在虚拟环境中可能无法正确找到Qt平台插件。

### 解决方案

#### 方案1：重新安装PyQt5（推荐）
```bash
pip uninstall PyQt5 -y
pip install PyQt5==5.15.10
```

#### 方案2：使用修复脚本
运行 `fix_qt_plugin.bat` 脚本

#### 方案3：测试诊断
运行 `python test_qt.py` 查看详细诊断信息

#### 方案4：在系统Python中安装
如果虚拟环境有问题，可以在系统Python中安装：
```bash
# 退出虚拟环境
deactivate

# 在系统Python中安装
pip install PyQt5==5.15.10

# 运行程序
python main.py
```

#### 方案5：设置环境变量
在运行程序前设置Qt插件路径：
```bash
# Windows PowerShell
$env:QT_PLUGIN_PATH = "你的虚拟环境路径\Lib\site-packages\PyQt5\Qt5\plugins"
python main.py
```

## 问题2：生成账单时程序闪退

### 可能原因
1. 数据库会话管理问题
2. 数据验证失败
3. 异常未正确处理

### 解决方案

#### 检查步骤
1. **查看错误信息**
   - 如果程序闪退，尝试在命令行运行：`python main.py`
   - 查看控制台输出的错误信息

2. **检查数据**
   - 确保已选择住户和收费项目
   - 确保住户和收费项目数据完整

3. **检查数据库**
   - 确保 `property.db` 文件未被其他程序占用
   - 检查数据库文件是否损坏

#### 已修复的问题
- ✅ 添加了数据验证（检查resident和charge_item是否存在）
- ✅ 改进了异常处理，显示详细错误信息
- ✅ 修复了数据库会话管理

### 如果问题仍然存在
1. 删除 `property.db` 文件，重新创建数据库
2. 检查是否有其他程序正在使用数据库
3. 查看程序日志（如果已添加日志功能）

## 问题3：程序无法启动

### 检查清单
- [ ] Python版本 >= 3.10
- [ ] 已安装所有依赖包
- [ ] PyQt5正确安装
- [ ] 数据库文件权限正常

### 诊断步骤
1. **测试Python环境**
   ```bash
   python --version
   ```

2. **测试PyQt5安装**
   ```bash
   python test_qt.py
   ```

3. **测试导入**
   ```bash
   python -c "from PyQt5.QtWidgets import QApplication; print('OK')"
   ```

4. **检查依赖**
   ```bash
   pip list | findstr PyQt5
   pip list | findstr SQLAlchemy
   ```

## 问题4：其他常见问题

### 数据库锁定
如果提示数据库被锁定：
- 关闭所有正在运行的程序实例
- 检查是否有其他程序在使用数据库文件
- 重启计算机（如果问题持续）

### 界面显示异常
- 尝试重新安装PyQt5
- 检查系统字体设置
- 更新显卡驱动

### 打印功能无法使用
- 确保系统已安装打印机驱动
- 检查打印机是否正常工作
- 尝试使用系统默认打印机

## 获取帮助

如果以上方法都无法解决问题，请：
1. 运行 `python test_qt.py` 获取诊断信息
2. 在命令行运行 `python main.py` 查看详细错误
3. 检查 `property.db` 文件是否正常
4. 提供完整的错误信息和系统环境信息

