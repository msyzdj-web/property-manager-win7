# 物业收费管理软件项目执行计划

## 一、项目概述
基于PyQt开发本地运行的物业收费管理系统，实现住户管理、收费管理、欠费查询和收据打印功能。

## 二、技术栈调整
- **GUI框架**：PyQt5/PyQt6（替代原计划的PySide6）
- **数据库ORM**：SQLAlchemy
- **数据库**：SQLite
- **打包工具**：PyInstaller

## 三、项目结构设计

```
wykf/
├── main.py                 # 主程序入口
├── models/                 # 数据模型层
│   ├── __init__.py
│   ├── database.py        # 数据库连接和初始化
│   ├── resident.py        # 住户模型
│   ├── charge_item.py     # 收费项目模型
│   └── payment.py         # 缴费记录模型
├── services/               # 业务逻辑层
│   ├── __init__.py
│   ├── resident_service.py
│   ├── charge_service.py
│   └── payment_service.py
├── ui/                     # UI界面层
│   ├── __init__.py
│   ├── main_window.py     # 主窗口
│   ├── resident_dialog.py # 住户管理对话框
│   ├── charge_dialog.py   # 收费项目管理对话框
│   ├── payment_dialog.py  # 缴费对话框
│   └── receipt_dialog.py  # 收据打印对话框
├── utils/                  # 工具类
│   ├── __init__.py
│   └── printer.py         # 打印工具
├── requirements.txt        # 依赖包列表
├── README.md              # 项目说明
└── 文档/                   # 项目文档（已有）
```

## 四、开发任务分解

### 阶段一：项目基础搭建（步骤1-3）
1. ✅ 创建项目目录结构
2. ✅ 配置依赖包（requirements.txt）
3. ✅ 实现数据库模型层（models）

### 阶段二：业务逻辑层开发（步骤4-6）
4. ✅ 实现住户管理服务（resident_service）
5. ✅ 实现收费项目服务（charge_service）
6. ✅ 实现缴费管理服务（payment_service）

### 阶段三：UI界面开发（步骤7-11）
7. ✅ 实现主窗口界面（main_window）
8. ✅ 实现住户管理对话框（resident_dialog）
9. ✅ 实现收费项目管理对话框（charge_dialog）
10. ✅ 实现缴费管理对话框（payment_dialog）
11. ✅ 实现收据打印功能（receipt_dialog + printer）

### 阶段四：功能集成与测试（步骤12-13）
12. ✅ 集成所有功能模块
13. ✅ 测试和优化

### 阶段五：打包部署（步骤14）
14. ✅ 配置PyInstaller打包脚本

## 五、详细功能实现清单

### 5.1 住户管理模块
- [x] 新增住户（房号唯一性校验）
- [x] 编辑住户信息
- [x] 删除住户（关联数据检查）
- [x] 住户列表展示
- [x] 住户搜索功能

### 5.2 收费项目管理模块
- [x] 新增收费项目（支持固定/按面积/手动三种类型）
- [x] 编辑收费项目
- [x] 删除收费项目
- [x] 收费项目列表展示

### 5.3 收费管理模块
- [x] 选择住户和收费项目生成账单
- [x] 计算费用（根据收费类型：固定、按面积、手动）
- [x] 记录缴费状态
- [x] 记录缴费时间和操作员
- [x] 账单列表展示
- [x] 按月份查询账单

### 5.4 欠费查询模块
- [x] 按月份查看未缴费清单
- [x] 欠费统计汇总

### 5.5 收据打印模块
- [x] 收据模板设计
- [x] 打印功能实现
- [x] 可重复打印已缴费记录

## 六、数据库表详细设计

### residents（住户表）
- id: INTEGER PRIMARY KEY
- room_no: VARCHAR(50) UNIQUE NOT NULL（房号，唯一）
- name: VARCHAR(100) NOT NULL（姓名）
- phone: VARCHAR(20)（电话）
- area: DECIMAL(10,2)（面积）
- status: INTEGER DEFAULT 1（状态：1-正常，0-停用）
- created_at: DATETIME（创建时间）
- updated_at: DATETIME（更新时间）

### charge_items（收费项目表）
- id: INTEGER PRIMARY KEY
- name: VARCHAR(100) NOT NULL（项目名称）
- price: DECIMAL(10,2) NOT NULL（单价/固定金额）
- charge_type: VARCHAR(20) NOT NULL（收费类型：fixed-固定，area-按面积，manual-手动）
- status: INTEGER DEFAULT 1（状态：1-启用，0-停用）
- created_at: DATETIME
- updated_at: DATETIME

### payments（缴费记录表）
- id: INTEGER PRIMARY KEY
- resident_id: INTEGER NOT NULL（住户ID，外键）
- charge_item_id: INTEGER NOT NULL（收费项目ID，外键）
- period: VARCHAR(20) NOT NULL（缴费周期，格式：YYYY-MM）
- amount: DECIMAL(10,2) NOT NULL（缴费金额）
- paid: INTEGER DEFAULT 0（缴费状态：1-已缴费，0-未缴费）
- paid_time: DATETIME（缴费时间）
- operator: VARCHAR(50)（操作员）
- created_at: DATETIME
- updated_at: DATETIME

## 七、开发时间估算
- 阶段一：1小时
- 阶段二：1.5小时
- 阶段三：3小时
- 阶段四：1小时
- 阶段五：0.5小时
- **总计：约7小时**

## 八、验收标准
- [x] 所有功能模块完整实现
- [x] 数据操作正确无误
- [x] UI界面美观易用
- [x] 打印功能正常
- [x] 数据安全可靠
- [x] 可独立打包运行

## 九、执行状态
- 计划制定：✅ 已完成
- 开发执行：✅ 已完成
- 功能测试：✅ 已完成
- 打包配置：✅ 已完成

## 十、项目完成总结

### 已完成功能
1. ✅ 数据库模型层（models）- 完成
2. ✅ 业务逻辑服务层（services）- 完成
3. ✅ UI界面层（ui）- 完成
4. ✅ 打印功能（utils/printer.py）- 完成
5. ✅ 主程序入口（main.py）- 完成

### 核心功能实现
- ✅ 住户管理：新增、编辑、删除、搜索
- ✅ 收费项目管理：支持固定、按面积、手动三种类型
- ✅ 收费管理：生成账单、标记缴费、查看记录
- ✅ 欠费查询：按月份查询未缴费清单和统计
- ✅ 收据打印：支持打印和重复打印

### 技术特点
- 采用PyQt5作为GUI框架
- SQLAlchemy ORM进行数据库操作
- SQLite本地数据库存储
- 三层架构：UI → Service → Model
- 完整的错误处理和用户提示

### 使用说明
1. 安装依赖：`pip install -r requirements.txt`
2. 运行程序：`python main.py`
3. 打包exe：运行 `build.bat` 或使用 `pyinstaller -F -w main.py`

